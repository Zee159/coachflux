# CoachFlux MVP

A B2B leadership reflection platform built on Convex with deterministic flows, strict guardrails, and low hallucination risk.

## Features

✅ **GROW Framework** - Structured coaching methodology (Goal, Reality, Options, Will, Review)  
✅ **Deterministic Flows** - Schema-driven conversation with strict validation  
✅ **LLM Guardrails** - Two-pass validation, banned term detection, safety incident logging  
✅ **Organizational Alignment** - Track alignment with company values  
✅ **Action Tracking** - Convert reflections into actionable items  
✅ **Safety First** - No therapy, medical, legal, or financial advice  

## Tech Stack

- **Backend**: Convex (serverless database + functions)
- **Frontend**: React + TypeScript + TailwindCSS
- **LLM**: OpenAI GPT-4o-mini (temperature 0, JSON mode)
- **Routing**: React Router
- **Build**: Vite

## Quick Start

### Prerequisites
- Node.js 20+
- pnpm 9+
- OpenAI API key

### Installation

```bash
# Install dependencies
pnpm install

# Start Convex dev server (opens dashboard)
pnpm convex:dev

# In Convex dashboard:
# 1. Set environment variable: OPENAI_API_KEY=sk-...
# 2. Note your deployment URL

# Start frontend dev server
pnpm dev
```

Visit `http://localhost:3000`

## Project Structure

```
coachflux/
├── convex/              # Backend functions and schema
│   ├── schema.ts        # Database schema
│   ├── coach.ts         # LLM coordinator with guardrails
│   ├── prompts.ts       # System and validation prompts
│   ├── mutations.ts     # Write operations
│   ├── queries.ts       # Read operations
│   └── metrics.ts       # Analytics and scoring
├── src/
│   ├── components/      # React components
│   │   ├── DemoSetup.tsx
│   │   ├── Dashboard.tsx
│   │   └── SessionView.tsx
│   ├── frameworks/      # Coaching frameworks
│   │   └── grow.json
│   ├── App.tsx
│   ├── main.tsx
│   └── index.css
├── tests/
│   └── evals/          # Test scenarios
│       ├── grow_basic.json
│       ├── safety_boundaries.json
│       └── character_limits.json
└── COACHFLUX_MVP_GUIDE.md  # Complete implementation guide
```

## How It Works

### 1. Deterministic Coaching Framework
The GROW model is defined as a JSON schema with required fields for each step:
- **Goal**: Desired outcome, timeline, success criteria
- **Reality**: Current state, constraints, resources
- **Options**: Multiple paths with pros/cons
- **Will**: Selected option with SMART actions
- **Review**: Summary and org value alignment score

### 2. LLM Guardrails (Two-Pass Validation)

**Primary Call** → LLM generates JSON response matching schema  
**Validator Call** → Separate LLM validates output and checks for banned terms

If validation fails:
- Log safety incident
- Return user-friendly error message
- Request rephrasing

### 3. Safety Controls
- Temperature: 0.0 (deterministic)
- Max input: 800 characters
- Max output: 300-600 tokens
- Banned terms: therapy, diagnose, cure, medical, legal advice, financial advice
- Rate limits: 1 active session per user, 20 LLM calls/day

### 4. Data Model

**Organizations** → company name + value glossary  
**Users** → linked to org, role-based access  
**Sessions** → one active per user, GROW framework state  
**Reflections** → validated LLM outputs per step  
**Actions** → SMART action items with due dates  
**Safety Incidents** → flagged content for review  

## Usage Flow

1. **Setup** - Create demo org with predefined values
2. **Start Session** - Initiates GROW framework flow
3. **Goal** - User describes desired outcome
4. **Reality** - User assesses current situation
5. **Options** - Explore multiple approaches
6. **Will** - Commit to specific actions
7. **Review** - Summarize and score alignment
8. **Dashboard** - View sessions, actions, stats

## Environment Variables

```bash
# .env.local (auto-generated by Convex)
VITE_CONVEX_URL=https://your-deployment.convex.cloud

# Set in Convex Dashboard → Settings → Environment Variables
OPENAI_API_KEY=sk-...
```

## Testing

### Manual Testing
1. Run through GROW flow with normal inputs
2. Test banned terms (therapy, diagnose, etc.)
3. Test input length limits (>800 chars)
4. Verify safety incident logging

### Evaluation Harness
See `tests/evals/` for canned test scenarios.

```bash
# Future: automated eval runner
pnpm test:evals
```

## Deployment

### Convex Backend
```bash
# Deploy to production
pnpm convex:deploy

# Set production environment variables in dashboard
```

### Frontend
```bash
# Build for production
pnpm build

# Deploy to Vercel/Netlify/etc
# Ensure VITE_CONVEX_URL points to production deployment
```

## Monitoring

Track in Convex dashboard:
- Function execution logs
- Error rates
- Safety incident severity
- LLM token usage

Alerts:
- >10% validator failure rate in 24h
- High severity safety incidents

## Roadmap

- [ ] Add CLEAR framework
- [ ] Manager dashboard with team analytics
- [ ] SSO integration (Google Workspace, Azure AD)
- [ ] Values-aware RAG for policy guidance
- [ ] Stripe integration for paid tiers
- [ ] Export reflections and actions (PDF, CSV)

## Security

- No PII in logs
- CSP headers on frontend
- Rate limiting per user
- Input sanitization
- No therapy or medical advice
- Safety disclaimers throughout UI

## License

Proprietary - Internal Use Only

## Support

For issues or questions, contact: [Your team contact info]

---

**Built with deterministic flows, strict guardrails, and production-first principles.**
